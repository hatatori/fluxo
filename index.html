<link rel="stylesheet" type="text/css" href="style.css">

<style>
	*{
		transition: 0.5s;
	}
	body{
		text-align: center;
		font-family: ubuntu
	}


</style>


<!-- <link href="https://unpkg.com/treeflex/dist/css/treeflex.css" rel="stylesheet"> -->

<textarea style="width: 450;height: 200" id="txt">1
	2
		3
		4
			5
			6
			7
		8
	9
	10
		11
		12</textarea>
<br><br>
<div class="tf-tree example" id="ok"></div>

<script>

	txt.onkeydown=function(e){
		
		if(e.key == "Tab"){
			e.preventDefault()
			this.value+="\t"
		}
	}

	txt.onkeyup=function(){
		go()
	}

	
	
	function go(){

		function tab(n){ try { return n.split("\t").length-1}catch(e){return 0} }

		linha = txt.value.split("\n")

		ordem = txt.value.split("\n").map(e=>e.split(/\t/g).length-1)

		ar = linha.map(e=>"<li>"+e.replace(/\t/g,"")+"</li>")

		lista = []
		s = 0


		
		u2 = document.createElement("ul")

		for(i=0;i<linha.length;i++){
			nome = linha[i].replace(/\t/g,"")
			lista.push(nome)
		}

		for(i=0;i<lista.length;i++){
			if(tab(linha[i+1]) > tab(linha[i])){
				lista[i] = "<li class='pos' p="+tab(linha[i])+"><span class='tf-nc'>"+lista[i]+"</span><ul pos='"+tab(linha[i+1])+"'></ul></li>"
			}else{
				lista[i] = "<li class='val' p="+tab(linha[i])+"><span class='tf-nc'>"+lista[i]+"</span></li>"
			}


		}

		u2 = document.createElement("ul")
		u2.innerHTML = lista.join("")

		po = u2.querySelectorAll(".pos")

		for(i=0;i<u2.childElementCount*7;i++){

			try{
				proximo = u2.children[s].nextSibling

				if(proximo.className != 'pos'){
					u2.children[s].querySelector('ul').appendChild(proximo)
				}else{
					s++
				}

			}catch(e){}
		}

		for(j=0;j<3;j++){
			for(i=u2.childElementCount-1;i>0;i--){
				try{

					// p1 = parseInt(u2.children[i].getAttribute("p"))
					// p2 = parseInt(u2.children[i-1].getAttribute("p"))

					p1 = tab(linha[i])
					p2 = tab(linha[i-1])

					if( p1 > p2 ){
						u2.children[i-1].querySelector("ul").appendChild(u2.children[i])
					}

					console.log(u2.children[i])
				}catch(e){}
			}
		}

	try{
		po[po.length-1].querySelector("ul").appendChild(u2.lastElementChild)
	}catch(e){
	}
	try{
		po[po.length-1].querySelector("ul").appendChild(u2.lastElementChild)
	}catch(e){
	}

	// verifica posição tab
	ql = u2.querySelectorAll("li")
	
	for(z=0;z<3;z++){
		for(i=0;i<ql.length;i++){
			pup = parseInt(ql[i].parentElement.getAttribute("pos"))
			patual = parseInt(ql[i].getAttribute("p"))

			if(patual < pup){
				console.log(ql[i].parentElement)
				console.log(ql[i])
				console.log("ok")

				ql[i].parentElement.parentElement.appendChild(ql[i])
			}
		}
	}

	ok.innerHTML = u2.outerHTML

	console.log(u2.outerHTML)
}

go()


	// div = document.createElement("div")
	// div.className = "tf-tree example"
	// div.appendChild(u2)
	// document.body.appendChild(div)
	
</script>